clear all
close all
clc

nb_iter=1000;
best = zeros(nb_iter,1);
x_init=zeros(47,1);
lub=zeros(47,2);

x_init = [1.9755556e+00  -5.1114511e+00   1.5909161e-03   2.8311075e-03  -8.3081557e+00   2.4938952e+00  -7.1324742e+00   2.4513698e+00   4.5838426e-02   2.5409565e-02   2.4043428e+00  -4.0729969e+00  -5.7435009e+00   1.9056576e-01   3.3494500e-04   2.9679825e-02  -2.9857753e+01   1.0310593e-01   5.0490311e-02   0.0000000e+00  -3.0537041e+00   8.3391335e+01  -2.9120080e+01   5.1874310e-02   4.2006344e-03  -4.3651587e+01   8.5324726e+00  -7.0095687e+01   7.2820058e+01   7.1291539e-04   1.8867628e-02   6.6837243e+01  -4.2320556e+01  -1.0871462e+02   4.8360021e-03   2.5247694e-02   5.3634327e-02  -2.9026238e+01   5.8436339e-02   1.2570765e-01   5.6294141e-02   5.6338926e-02   1.6602716e+04   2.0445230e+04   7.4081113e+03   8.9388225e-02 0.25]';    
lub(:,1)=[0.5,0.5,0.05,0.05,0.5,0.5,0.5,0.5,0.05,0.05,0.5,0.5,0.5,0.05,0.05,0.05,0.5,0.05,0.05,0.05,0.5,0.5,0.5,0.05,0.05,0.5,0.5,0.5,0.5,0.05,0.05,0.5,0.5,0.5,0.05,0.05,0.05,0.5,0.05,0.05,0.05,0.05,0.5,0.5,0.5,0.5,0.5]';
lub(:,2)=[2,2,3,3,2,2,2,2,3,3,2,2,2,3,3,3,2,3,3,0,2,2,2,3,3,2,2,2,2,3,3,2,2,2,3,3,3,2,3,3,3,3,2,2,2,2,2]';

[accumulations, VHT] = runSim4calib(x_init', [7 3]);
data = [accumulations x_init' VHT];
save DATA.dat data -ascii;
best(1) = VHT;

for i=2:nb_iter
    aft_main(lub);
    aft_param = load('aft_param.dat');
    [accumulations, VHT] = runSim4calib(aft_param', [7 3]);
    previous_data = load('DATA.dat');
    data = [previous_data; accumulations aft_param' VHT];
    save DATA.dat data -ascii;
    best(i) = min(data(:,end));
    fprintf('Iteration %f, obj %f\n',i,best(i))
end
